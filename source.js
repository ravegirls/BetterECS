// ==UserScript==
// @name         
// @namespace    http://tampermonkey.net/
// @version      release-80283fb2-46e5-4508-8802-bcbc0b28cdb2
// @description  Economy Simulator Overhaul Plugin (Dev)
// @author       isabella
// @match        https://ecsr.io/*
// @grant        GM_addStyle
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_getResourceURL
// @grant        GM_getResourceText
// @grant        GM_deleteValue
// @resource     notify https://cdn.pixabay.com/download/audio/2025/06/22/audio_76f254e734.mp3?filename=new-notification-014-363678.mp3
// @resource     errorIcon https://cdn-icons-png.flaticon.com/512/1828/1828843.png
// @resource     infoIcon https://cdn-icons-png.flaticon.com/512/1828/1828817.png
// @resource     frutigerGif https://imgs.search.brave.com/7mRlFUU09XpY94SiqyxlmhER3UnemBu4Y9j2ejnTQ4o/rs:fit:860:0:0:0/g:ce/aHR0cHM6Ly9pLnBp/bmltZy5jb20vb3Jp/Z2luYWxzLzAxL2Uy/L2VmLzAxZTJlZjg5/ZjA5ZDhhNWU3OGNj/ZGNhMzRmZTU5MDI2/LmdpZg.gif
// @resource     oldBackground https://cdn.discordapp.com/attachments/1344823831784587295/1415866330933891193/roblox_blue_city_bg_by_karagolge_di0jmi2-fullview.png?ex=68c56c86&is=68c41b06&hm=b4715c72d7ba988c7152c5b2f98a4677471f37cf0d92d151b61cb225ff6cf8e1
// @resource     popperJs https://unpkg.com/@popperjs/core@2/dist/umd/popper.min.js
// @resource     tippyJs https://unpkg.com/tippy.js@6/dist/tippy-bundle.umd.js
// @resource     pickrJs https://cdn.jsdelivr.net/npm/@simonwep/pickr@1.8.0/dist/pickr.min.js
// @resource     pickrCss https://cdn.jsdelivr.net/npm/@simonwep/pickr@1.8.0/dist/themes/classic.min.css
// @resource     tippyCss https://unpkg.com/tippy.js@6/dist/tippy.css
// @resource     imGui https://cdn.jsdelivr.net/npm/dat.gui@0.7.7/build/dat.gui.min.js
// @resource     valueIcon https://github.com/ravegirls/eco_assets/blob/main/img-robux.png?raw=true
// ==/UserScript==
!async function(){"use strict";function e(e){return new Promise(t=>setTimeout(t,e))}let t="#9f4e65ff",n="#c7607eff",o="#eb5b84ff",a="#F68802",r={useGradient:!1,syncedAlertWithTopbar:!1,smoothSidebar:!1,materialDesign:!1,tradeNotifications:!0,itemNotifications:!0,showAds:!0,animatedAlert:!1};async function i(){await GM_setValue("primaryColor",t),await GM_setValue("secondaryColor",n),await GM_setValue("accentColor",o),await GM_setValue("alertColor",a),Object.entries(r).forEach(async([e,t])=>{await GM_setValue(e,1==t?"True":"False")})}async function s(e){return await GM_getValue(e)}let l="00-300-0003-3125";GM_getValue(l)||i(),GM_setValue(l,!0),await async function(){t=await s("primaryColor"),n=await s("secondaryColor"),o=await s("accentColor"),a=await s("alertColor"),Object.entries(r).forEach(async([e,t])=>{r[e]="True"==await GM_getValue(e)}),console.log(t,n,o,a)}();let c,d,p=document.getElementById("notification-container");if(p||(p=document.createElement("div"),p.id="notification-container",Object.assign(p.style,{position:"fixed",top:"10px",left:"50%",transform:"translateX(-50%)",display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",zIndex:9999,pointerEvents:"none"}),document.body.appendChild(p)),GM_addStyle(`\n .col-lg-8 {\n        flex: 0 0 auto;\n        width: 66.66666667%;\n        background: rgba(0, 0, 0, 0);\n    }\n    .body {\n        background-color: rgba(0, 0, 0, 0);\n    }\n\n    /* topbar */\n    a,\n    html a,\n    p > a {\n        color: var(--bs-theme-secondary);\n        text-decoration: none !important;\n        cursor: pointer;\n    }\n    .fw-bolder {\n        font-weight: normal !important;\n    }\n    p,\n    div,\n    span,\n    a,\n    h1,\n    h2,\n    h3,\n    button {\n        font-weight: lighter !important;\n    }\n\n    :root {\n        --bs-theme-secondary: ${r.useGradient?`linear-gradient(135deg, ${t} 0%, ${n} 50%, ${o} 100%)`:t};\n        --bs-theme: ${r.useGradient?`linear-gradient(180deg, ${t} 0%, ${n} 50%, ${o} 100%)`:t};\n        --bs-topbar: ${r.useGradient?`linear-gradient(0deg, ${t} 0%, ${n} 50%, ${o} 100%)`:t};\n        --bs-alert: ${r.useGradient&&r.syncedAlertWithTopbar?`linear-gradient(0deg, ${t} 0%, ${n} 50%, ${o} 100%)`:a};\n        /*rgba(145, 3, 233, 1) !important;*/\n        --bs-theme-icon: rgb(233, 233, 233) !important;\n        --bs-theme-href: #8bb5e2 !important;\n        --bs-theme-labels: rgb(246, 246, 246) !important;\n        /*--bs-light-rgb: */\n    }\n\n\n    .count-d29-0-2-169,\n    .count-d29-0-2-169,\n    .upgradeNowButton-d8-0-2-158 {\n        background: var(--bs-theme)\n    }\n\n    div[class*="alertBg"] {\n        /* Keep your locked scale stuff */\n        background-repeat: repeat;\n        background-size: 2200px 100px;\n\n        background: var(--bs-alert);\n\n\n        background-blend-mode: normal;\n    }\n\n    div[class*="alertText"] {\n        background: rgba(0, 0, 0, 0) !important;\n    }\n\n    /* announcement color */\n    p[class*="upgradeNowButton"],\n    div[id*="LabelAnnouncement"],\n    div[id*="SystemAlertDiv"] {\n        background: var(--bs-theme) !important;\n        color: var(--bs-theme-labels) !important;\n    }\n    nav[class*="navbar fixed"] {\n        background: var(--bs-topbar) !important;\n    }\n    button[class*="buyButton"],button[class*="defaultBg"] {\n        background: var(--bs-topbar) !important;\n        border-radius: 3px;\n        border: 0px;\n    }\n    a[href*="/"]:not([class*="linkEntry"], [class*="text-white"], [class*="alertLink"]),\n    a[href*="#"]:not([class*="linkEntry"], [class*="text-white"], [class*="alertLink"]) {\n        color: var(--bs-theme-href) !important;\n    }\n    span[class*="count"]:not([class*="countWrapper"], [class*="accountInfoValue"]), button[class*="buttons_legacyButton"] {\n        background: var(--bs-theme) !important;\n        color: var(--bs-theme-labels) !important;\n    }\n\n    option[class*="option"],option[class*="dropWrapper"] {\n        background: rgb(10, 10, 10) !important;\n    }\n\n\n\n    span[class*="labelBg"] {\n        background: rgba(0, 0, 0, 0) !important;\n    }\n\n    img[class*="adImage"] {\n        background: rgb(1, 1, 1) !important;\n    }\n\n\n\n\n  `),r.smoothSidebar&&GM_addStyle('\n    div[class*="navIcons"] {\n        transition: transform 0.25s linear, background 0.5s ease-in;\n        transform: translate(-115px, 0px);\n        background: linear-gradient(90deg, rgb(25, 26, 31), rgba(25, 26, 31, 0.7));\n    }\n\n    div[class*="navIcons"]:hover {\n      transform: translate(0px, 0px);\n      background: linear-gradient(90deg, rgb(25, 26, 31), rgba(25, 26, 31, 1.0));\n    }'),r.showAds||setInterval(()=>{document.querySelectorAll('[class*="adImage"]').forEach(e=>{e.remove()})},60),r.animatedAlert&&GM_addStyle('\ndiv[class*="alertBg"] {             height: 40px; bottom-padding: 10; margin-bottom: 10px; }\n              a[class*="alertLink"] {\n            position: absolute;\n            transform: translate(0px, -5px);\n            white-space: nowrap;\n            animation: moveText 10s ease-in-out infinite;\n        }\n\n              @keyframes moveText {\n            0% {\n                left: -100%; /* Starts off-screen to the left */\n            }\n            100% {\n                left: 100%; /* Moves off-screen to the right */\n            }\n        }\n\n        '),r.materialDesign&&GM_addStyle('\n      :root {\n        --shadow-color: rgba(13, 11, 11, 0.6)\n      }\n\n      nav[id*="sidebarMenu"] {\n        background: rgba(18, 18, 21, 0.25) !important;\n        box-shadow: 0 10px 20px var(--shadow-color);\n        backdrop-filter: blur(10px);\n        -webkit-backdrop-filter: blur(10px);\n        border-radius: 6px;\n    }\n\n    div[class*="gamesContainer"],div[class*="gameContainer"],div[class*="default-error-page"],header[class*="navbar navbar-dark sticky-top"] {\n        background: rgba(18, 18, 21, 0.25) !important;\n        box-shadow: 0 10px 20px var(--shadow-color);\n        backdrop-filter: blur(10px);\n        -webkit-backdrop-filter: blur(10px);\n        border-radius: 6px;\n        z-index: 1;\n    }\n\n    div[class*="dropdown"]:not([class*="dropdownEntry"]) {\n        z-index: 3333333333; !important;\n        background: rgba(18, 18, 21, 0.25) !important;\n        box-shadow: 0 10px 20px var(--shadow-color);\n        backdrop-filter: blur(10px);\n        -webkit-backdrop-filter: blur(10px);\n        border-radius: 6px;\n        flex-direction: row;\n        position: relative;\n    }\n\n    div[class*="dropdownEntry"],p[class*="dropdown"] {\n        z-index: 3333333333; !important;\n        position: relative;\n    }\n\n    div[class*="vTab"] {\n        background: rgba(18, 18, 21, 0.25) !important;\n        box-shadow: 0 10px 20px var(--shadow-color);\n        backdrop-filter: blur(10px);\n        -webkit-backdrop-filter: blur(10px);\n        border-radius: 6px 6px 0px 0px;\n\n    }\n\n    div[class*="card"]:not([class*="gameCard"]),div[class*="imageBig"] {\n        background: rgba(18, 18, 21, 0.25) !important;\n        box-shadow: 0 10px 20px var(--shadow-color);\n        backdrop-filter: blur(10px);\n        -webkit-backdrop-filter: blur(10px);\n        border-radius: 6px 6px 6px 6px;\n        padding: 5px;\n\n    }\n\n    div[class*="overviewDetails"]\n  '),window.location&&window.location.href.match("/admin")){(async()=>{if("Notification"in window){await window.Notification.requestPermission()}})()}function u(e){const t=[],n=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,null,!1);let o;for(;o=n.nextNode();)o.nodeValue.trim()===e&&t.push(o.parentElement);return t}c=setInterval(()=>{const e=u("Admin Panel");0!=e.length&&(e.forEach(e=>{e.innerHTML="NUKE SITE BUTTON"}),clearInterval(c))},30),d=setInterval(()=>{const e=u("Management");0!=e.length&&e.forEach(e=>{e.remove()})},30),function e(t,n,o){let a;a=setInterval(()=>{const r=u("Settings");0!=r.length&&(r.forEach(a=>{if(a.className&&!a.className.match("text-white"))return;const r=a.parentElement.cloneNode(!0),i=r.firstChild;let s;i.textContent=t,i.onclick=n,i.removeAttribute("href"),a.parentElement.parentElement.appendChild(r),s=setInterval(()=>{if(0==u(t).length||!a.parentElement)return clearInterval(s),e(t,n,o)},30)}),clearInterval(a))},30)}("Configuration",function(){if(window.hasConfigOpen)return v("A configuration menu currently exists!");window.hasConfigOpen=!0,GM_addStyle("\n        .dg.ac {\n            position: absolute !important;\n            z-index: 9999 !important;\n        }\n    ");let e,s=0;e=setInterval(()=>{const t=document.getElementsByClassName("default-error-page");0!=t.length&&(t[0].remove(),s+=1,s>=2&&clearInterval(e))},200);const l=document.createElement("script");l.type="application/javascript",l.innerHTML=GM_getResourceText("imGui"),document.head.appendChild(l);const c=new dat.GUI({name:"ECSR Configuration",hideable:!1});let d={};async function p(e,t,n){d[e]=t.color,(await c.addColor(d,e)).onChange(n)}p("primary color",{color:t.slice(0,7)},e=>{t=e}),p("secondary color",{color:n.slice(0,7)},e=>{n=e}),p("accent color",{color:o.slice(0,7)},e=>{o=e}),p("alert color",{color:a.slice(0,7)},e=>{a=e}),Object.entries(r).forEach(([e,t])=>{console.log(e,t),async function(e,t,n){d[e]=t.toggle,(await c.add(d,e)).onChange(n)}(e,{toggle:t},t=>{r[e]=t})}),c.add({save:()=>{i(),v("Saving config...",{glowColor:t}),setTimeout(function(){window.location.assign("https://ecsr.io/home")},500)}},"save").name("save configuration"),c.add({revert:()=>{setTimeout(function(){window.location.assign("https://ecsr.io/home")},10)}},"revert").name("revert changes");const m=u("Close Controls");0!=m.length&&m.forEach(e=>{let t;e.textContent="close",t=setInterval(function(){"close"!=e.textContent&&(window.location.assign("https://ecsr.io/home"),e.textContent="open...",clearInterval(t))},100)})}),window.location&&window.location.href,window.showNotification=function({title:e="Notification",text:t="",image:n="",duration:o=5e3,onClickCallback:a=null}){function r(){const r=new Notification(e,{body:t,icon:n||void 0});a&&"function"==typeof a&&(r.addEventListener("click",()=>{a(),r.close()}),r.addEventListener("focus",()=>{a(),r.close()})),o>0&&setTimeout(()=>{r.close()},o)}"Notification"in window?"default"===Notification.permission?Notification.requestPermission().then(e=>{"granted"===e&&r()}):"granted"===Notification.permission?r():console.warn("Notifications permission denied"):alert("This browser does not support desktop notifications.")};const m=!1;let f=null,h=!1,g=null;async function b(e,t={}){t.headers=t.headers||{},g&&(t.headers["x-csrf-token"]=g);let n=await fetch(e,t);if(403===n.status){const o=n.headers.get("x-csrf-token");console.log(o),o&&(g=o,t.headers["x-csrf-token"]=g,n=await fetch(e,t))}return n}async function w(e){const t={items:[{itemType:"Asset",id:e}]},n={method:"POST",headers:{accept:"application/json, text/plain, */*","accept-language":"en-US,en;q=0.5","content-type":"application/json",priority:"u=1, i","sec-ch-ua":'"Chromium";v="140", "Not=A?Brand";v="24", "Brave";v="140"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin",cookie:document.cookie,"sec-gpc":"1"},body:JSON.stringify(t),mode:"cors",credentials:"include",referrer:`https://ecsr.io/catalog/${e}/redirected?red=true&allow=[0]`};try{const e=await b("https://ecsr.io/apisite/catalog/v1/catalog/items/details",n);if(!e.ok)throw new Error(`Request failed with status: ${e.status}`);const t=await e.json();return console.log("Success:",t),t}catch(e){throw console.error("Error:",e),e}}b("https://ecsr.io/apisite/groups/v1/groups/2/rolesets/255");try{w("103796")}catch{window.showNotification({title:"ECS:R",text:"Failed to correctly load item data for CSRF Token",duration:1e4})}function x(){const e=Array.from(p.children);let t=0;e.forEach(e=>{const n=e.scrollWidth;n>t&&(t=n)}),e.forEach((n,o)=>{n.style.width=`${t}px`;let a="12px",r="12px";o>0&&(a="4px"),o<e.length-1&&(r="4px"),n.style.borderRadius=`${a} ${a} ${r} ${r}`})}let y=0;function v(e,t={}){const n=t.duration||3e3,o=t.bgColor||"rgba(30,30,30,0.6)",a=t.textColor||"#fff",r=t.glowColor||"#fff",i=t.icon||null,s=t.redirect||null,l=document.createElement("div");if(Object.assign(l.style,{display:"flex",alignItems:"center",background:o,color:a,padding:"12px 24px",fontFamily:"sans-serif",fontSize:"16px",opacity:0,transform:"translateY(-50px)",transition:"transform 0.4s ease, opacity 0.4s ease, border-radius 0.3s ease, width 0.3s ease",pointerEvents:"auto",boxShadow:`\n            0 0 2px ${r}44,\n            0 0 6px ${r}33,\n            0 0 12px ${r}22,\n            0 0 24px ${r}11\n      `,backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",gap:"12px",whiteSpace:"nowrap"}),i){const e=document.createElement("img");e.src=i,Object.assign(e.style,{width:"24px",height:"24px",objectFit:"contain"}),l.appendChild(e)}s&&(l.addEventListener("click",()=>{window.open(s,"_blank")}),l.href=s);const c=document.createElement("span");c.textContent=e,l.appendChild(c),p.appendChild(l),requestAnimationFrame(()=>{const e=l.offsetWidth;e>y&&(y=e),x(),l.style.opacity=1,l.style.transform="translateY(0)"}),setTimeout(()=>{l.style.opacity=0,l.style.transform="translateY(-50px)",l.addEventListener("transitionend",()=>{l.remove(),y=Math.max(...Array.from(p.children).map(e=>e.offsetWidth),0),updateRoundedCorners()})},n)}async function C(e){const t=await fetch(`https://ecsr.io/apisite/thumbnails/v1/users/avatar-headshot?userIds=${e}&size=420x420&format=png`);if(!t.ok)throw new Error(`Failed to fetch headshot for ${e}: ${t.status}`);const n=await t.json();return n.data?.[0]?.imageUrl||null}setTimeout(()=>{let e=!1;if(GM_getValue("promptPurchase")){let t=GM_getValue("promptPurchase");window.location.href.match(t)&&(e=!0)}if(console.log(GM_getValue("promptPurchase"),window.promptPurchase),window.promptPurchase||e){let e;e=setInterval(()=>{const n=u("Buy with R$");0!=n.length&&(n[0].click(),v("Prompting purchase!",{glowColor:t}),clearInterval(e))},200)}},300);let k=null,E=null;async function S(){if(r.tradeNotifications)try{const e=await fetch("https://ecsr.io/apisite/trades/v1/trades/inbound?cursor=");if(!e.ok)throw new Error("Failed to fetch inbounds");const n=await e.json();let o=JSON.stringify(n.data);if(k!=o){let e=n.data,o={},a={},r=!0,i=-1;console.log(e);for(let t=0;t<e.length;t++){const n=e[t],s=n.user.id,l=n.user.displayName;-1===i?i=s:s!==i&&(r=!1),o[s]||(o[s]=0),o[s]++,a[l]||(a[l]=n.user)}if(console.log(o,a),r){let n=e[0],a=await fetch(`https://ecsr.io/apisite/thumbnails/v1/users/avatar-headshot?userIds=${n.user.id}&size=420x420&format=png`),r=(await a.json()).data[0].imageUrl,i=o[n.user.id];v(i<=1?`New inbound from ${n.user.displayName}`:`${i} new inbounds from ${n.user.displayName}`,{icon:r,bgColor:"#0606066e",glowColor:t,duration:5e3,redirect:"https://ecsr.io/My/Trades.aspx"})}else{let e,n=0,r=[];if(Array.isArray(a)?r=a.map(e=>e&&(e.displayName||e.name)||String(e)).filter(Boolean):a&&"object"==typeof a&&(r=Object.values(a).map(e=>e&&(e.displayName||e.name)||String(e)).filter(Boolean)),0===r.length)e="someone";else if(r.length<=2)e=r.join(", ");else{const t=r.length-2;e=`${r[0]}, ${r[1]} and ${t} other${1===t?"":"s"}`}if(Array.isArray(o))for(let e=0;e<o.length;e++)n+=Number(o[e]||0);else if(o&&"object"==typeof o)for(const e in o)Object.prototype.hasOwnProperty.call(o,e)&&(n+=Number(o[e]||0));else n=Number(o)||0;const i=await async function(e){const t=Object.values(e||{}).slice(0,3),n=[];for(const e of t){const t=await C(e.id);n.push({displayName:e.displayName||e.name||"someone",avatar:t})}return n}(a);!function(e,t={}){const n=t.duration||3e3,o=t.bgColor||"rgba(30,30,30,0.6)",a=t.textColor||"#fff",r=t.glowColor||"#fff",i=t.redirect||null,s=Array.isArray(t.users)?t.users:[],l=Number(t.maxAvatars)||5,c=Number(t.avatarSize)||28,d=Number(t.overlap)||10,u=document.createElement("div");if(Object.assign(u.style,{display:"flex",alignItems:"center",background:o,color:a,padding:"12px 16px",fontFamily:"sans-serif",fontSize:"16px",opacity:0,transform:"translateY(-50px)",transition:"transform 0.35s ease, opacity 0.35s ease, border-radius 0.25s ease, width 0.25s ease",pointerEvents:"auto",cursor:i?"pointer":"default",boxShadow:`\n      0 0 2px ${r}44,\n      0 0 6px ${r}33,\n      0 0 12px ${r}22,\n      0 0 24px ${r}11\n    `,backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:"12px",gap:"12px",whiteSpace:"nowrap",boxSizing:"border-box",overflow:"hidden"}),s.length>0){const e=document.createElement("div");Object.assign(e.style,{display:"flex",alignItems:"center",marginRight:"8px",position:"relative",height:`${c}px`,pointerEvents:"none"});const t=Math.min(s.length,l);for(let n=0;n<t;n++){const o=s[n],a=document.createElement("img");a.src=o.avatar||o.icon||"",a.alt=o.displayName||"";const r=1-n/t*.5;Object.assign(a.style,{width:`${c}px`,height:`${c}px`,borderRadius:"50%",objectFit:"cover",border:"2px solid rgba(0,0,0,0.35)",boxShadow:"0 1px 3px rgba(0,0,0,0.4)",marginLeft:0===n?"0px":`-${d}px`,opacity:r.toString(),zIndex:""+(10+t-n),display:"block"}),a.addEventListener("load",x),a.addEventListener("error",x),e.appendChild(a)}if(s.length>l){const n=document.createElement("div"),o=s.length-l;n.textContent=`+${o}`,Object.assign(n.style,{width:`${c}px`,height:`${c}px`,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",marginLeft:`-${d}px`,zIndex:`${10+t}`,background:"rgba(0,0,0,0.35)",color:"#fff",fontSize:"12px",border:"2px solid rgba(0,0,0,0.35)"}),e.appendChild(n)}u.appendChild(e)}const m=document.createElement("span");m.textContent=e,m.style.pointerEvents="auto",u.appendChild(m),i&&u.addEventListener("click",()=>{window.open(i,"_blank")}),p.appendChild(u),requestAnimationFrame(()=>{x(),requestAnimationFrame(()=>{u.style.opacity=1,u.style.transform="translateY(0)"})}),setTimeout(()=>{u.style.opacity=0,u.style.transform="translateY(-50px)",u.addEventListener("transitionend",()=>{u.remove(),x()},{once:!0})},n)}(`${n>9?"9+":String(n)} new inbounds from ${e}`,{users:i,overlap:15,bgColor:"#0606066e",glowColor:t,duration:5e3,redirect:"https://ecsr.io/My/Trades.aspx"})}}k=o,E=n.data}catch{}}async function $(){if(r.itemNotifications)try{const e=await fetch("https://ecsr.io/apisite/catalog/v1/search/items?category=Featured&limit=28&sortType=0");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();let n=JSON.stringify(t.data);if(console.log(n),h&&m&&(window.showNotification({title:"ECS:R",text:"ECS:R is no longer under maintenance!",duration:5500}),h=!1),null===f)console.log("Initial data loaded."),n={};else if(f!==n){console.log("Data has changed!");const e=t.data[0].id;if(GM_getValue("dropped_"+e))return;GM_setValue("dropped_"+e,"hi");const n=await fetch("https://ecsr.io/apisite/thumbnails/v1/assets?assetIds="+e);if(null==n)return console.error("Failed to get thumbnailData");const o=(await w(e)).data[0];let a=(await n.json()).data[0].imageUrl;const r=o.price,i=o.name,s={title:i,text:r+"$",image:a,duration:0,onClickCallback:async function(){window.focus(),await GM_setValue("promptPurchase",String(e));const t=window.open("https://ecsr.io/catalog/"+e+"/--?promptPurchase=true","__eacf63");t.onload=()=>{t.promptPurchase=!0}}};v("New drop! "+i,{icon:a,bgColor:"#444",glowColor:"#ffcc00",duration:5e3}),window.showNotification(s)}f=n}catch(e){!h&&m&&(window.showNotification({title:"ECS:R",text:"ECS:R is under maintenance!",duration:5500}),h=!0),console.error("Fetch error:",e)}}S(),setInterval(S,7500),setInterval($,1750),$(),setTimeout(async()=>{if(!window.location.href.match("https://ecsr.io/catalog/"))return;const e=Array.from(document.querySelectorAll("p")).find(e=>e.textContent.includes("Sold")),t=e?.querySelector("span.text-white"),n=window.location.href.replace("https://ecsr.io/catalog/","").split("/")[0],o=await fetch(`https://ecsr.io/apisite/inventory/v2/assets/${n}/owners?cursor=0&limit=100&sortOrder=Asc`),a=await o.json();console.log(o,a),t.textContent=String((await a).data.length-1)},5e3);let N=null;const I=new Map;N=setInterval(async function t(){if(!window.location.href.match("https://ecsr.io/My/Trades.aspx"))return;const n=Array.from(document.querySelectorAll("p")).filter(e=>e.textContent.includes("Total RAP"));if(n.length<2)return;clearInterval(N);for(const t of n){const n=t.querySelector('[class*="robuxLabel"]');if(!n)continue;const o=n.parentElement.cloneNode(!0),a=n.parentElement.parentElement,r=o.querySelector('[class*="valueLabel"]'),i=o.querySelector('[class*="robuxLabel"]'),s=o.querySelector('[class*="robuxIconLg"]');if(!(r&&i&&s))continue;r.textContent="Total Value:",i.textContent="WAITING FOR ITEMS...",i.style.color="rgb(96,165,250)",s.src=GM_getResourceURL("valueIcon"),a.appendChild(o),a.style.display="flex",a.style.flexDirection="row";let l=t.closest(".row")?.nextElementSibling,c=l?l.querySelectorAll('a[href*="/catalog/"]'):[];for(;0===c.length;)l||(l=t.closest(".row")?.nextElementSibling),c=l?l.querySelectorAll('a[href*="/catalog/"]'):[],await e(150);i.textContent="Calculating...";const d=Array.from(c).map(e=>({name:e.textContent.trim(),href:e.href,object:e}));Array.from(c).forEach(e=>{if(!e.querySelector(".valueOverlay")){const t=document.createElement("div");t.classList.add("valueOverlay"),t.textContent="Item Value",t.style.position="absolute",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.color="white",t.style.fontWeight="bold",t.style.textAlign="center",t.style.pointerEvents="none",e.appendChild(t),e.parentElement.parentElement.addEventListener("mouseenter",()=>{t.style.opacity="1"}),e.parentElement.parentElement.addEventListener("mouseleave",()=>{t.style.opacity="0"}),t.style.opacity="0"}});let p=0;const u=d.map(async e=>{try{const t=e.href.replace("https://ecsr.io/catalog/","").split("/")[0];let n;if(I.has(t))n=I.get(t);else{const e=await fetch(`https://ecomons.xyz/api/items/${t}?owners=true`),o=await e.json();n=o.db?.value||0,I.set(t,n)}return e.object.parentElement.getElementsByClassName("valueOverlay")[0].textContent=n,p+=n,{...e,value:n}}catch{return{...e,value:0}}});await Promise.all(u),i.textContent=p.toLocaleString()}let o=setInterval(()=>{const e=document.querySelector('[class*="valueLabel"]');e&&e.parentElement||(clearInterval(o),t(),N=setInterval(t,1e3))},100)},1e3)}();