// ==UserScript==
// @name         BetterECS
// @namespace    http://tampermonkey.net/
// @version      0.0.47
// @description  Economy Simulator Overhaul Plugin (Dev)
// @author       isabella
// @match        https://ecsr.io/*
// @grant        GM_addStyle
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_getResourceURL
// @grant        GM_getResourceText
// @grant        GM_deleteValue
// @grant        GM_xmlhttpRequest
// @updateURL    https://raw.githubusercontent.com/ravegirls/BetterECS/refs/heads/main/source.user.js
// @downloadURL  https://raw.githubusercontent.com/ravegirls/BetterECS/refs/heads/main/source.user.js
// @resource     notify https://cdn.pixabay.com/download/audio/2025/06/22/audio_76f254e734.mp3?filename=new-notification-014-363678.mp3
// @resource     errorIcon https://cdn-icons-png.flaticon.com/512/1828/1828843.png
// @resource     infoIcon https://cdn-icons-png.flaticon.com/512/1828/1828817.png
// @resource     frutigerGif https://imgs.search.brave.com/7mRlFUU09XpY94SiqyxlmhER3UnemBu4Y9j2ejnTQ4o/rs:fit:860:0:0:0/g:ce/aHR0cHM6Ly9pLnBp/bmltZy5jb20vb3Jp/Z2luYWxzLzAxL2Uy/L2VmLzAxZTJlZjg5/ZjA5ZDhhNWU3OGNj/ZGNhMzRmZTU5MDI2/LmdpZg.gif
// @resource     oldBackground https://cdn.discordapp.com/attachments/1344823831784587295/1415866330933891193/roblox_blue_city_bg_by_karagolge_di0jmi2-fullview.png?ex=68c56c86&is=68c41b06&hm=b4715c72d7ba988c7152c5b2f98a4677471f37cf0d92d151b61cb225ff6cf8e1
// @resource     popperJs https://unpkg.com/@popperjs/core@2/dist/umd/popper.min.js
// @resource     tippyJs https://unpkg.com/tippy.js@6/dist/tippy-bundle.umd.js
// @resource     pickrJs https://cdn.jsdelivr.net/npm/@simonwep/pickr@1.8.0/dist/pickr.min.js
// @resource     pickrCss https://cdn.jsdelivr.net/npm/@simonwep/pickr@1.8.0/dist/themes/classic.min.css
// @resource     tippyCss https://unpkg.com/tippy.js@6/dist/tippy.css
// @resource     imGui https://cdn.jsdelivr.net/npm/dat.gui@0.7.7/build/dat.gui.min.js
// @resource     valueIcon https://github.com/ravegirls/eco_assets/blob/main/img-robux.png?raw=true
// @resource     verificationHeartTick https://imgs.search.brave.com/l46S-kt9zc8lNllaFOq0tUvzTtJt6n8cx2fwhM0xOms/rs:fit:860:0:0:0/g:ce/aHR0cHM6Ly9zeW1i/bC1jZG4uY29tL2kv/d2VicC82Ny81NWIx/NzY1ODQ1NzE1M2Vl/N2JlNWY4NWYwMzI1/YTIud2VicA
// @resource     nyanCatTick https://imgs.search.brave.com/5AusP691t8poCdvbch7M2hmONE7-VLaJ_vdVYvLwM8s/rs:fit:860:0:0:0/g:ce/aHR0cHM6Ly93d3cu/cnctZGVzaWduZXIu/Y29tL2ljb24taW1h/Z2UvMjAzNjctMjU2/eDI1NngzMi5wbmc
// @resource     pawIcon https://imgs.search.brave.com/sqEYsC0AHS_vBtjfOo5kEv0YajnvfvfO0FQRr0ZGqwI/rs:fit:860:0:0:0/g:ce/aHR0cHM6Ly9pLnBp/bmltZy5jb20vb3Jp/Z2luYWxzLzQyLzE3/L2FkLzQyMTdhZDBk/ZTg5MWYwZjU4YzNj/OWI5N2UyMTgxNGZk/LmpwZw
// @resource     chudIcon https://imgs.search.brave.com/N7ALaqllTLrNW_y3gwcVmUmUR-P51qgdQmewFdhwI18/rs:fit:860:0:0:0/g:ce/aHR0cHM6Ly9pLmlt/Z2ZsaXAuY29tLzlo/OGlyYS5wbmc
// @resource     americowIcon https://github.com/ravegirls/eco_assets/blob/main/image.png?raw=true
// @resource     chiraqIcon https://github.com/ravegirls/eco_assets/blob/main/Peak.png?raw=true
// @resource     discordIcon https://imgs.search.brave.com/mRHkIaGFNtQ-vkIukHc9y2D28x34KVTs9Luu59lty6s/rs:fit:860:0:0:0/g:ce/aHR0cHM6Ly9jZG4t/aWNvbnMtcG5nLmZs/YXRpY29uLmNvbS8x/MjgvNDk0NS80OTQ1/OTczLnBuZw
// @resource     maticIcon https://github.com/ravegirls/eco_assets/blob/main/image.gif?raw=true
// ==/UserScript==
/*a966f4146f125a67157187b128dafb9985dfc77d39788b6538d484b2acfb51ef93073d276edccc5d23e221f635a155e85eab1d1dcd4b10095cda0fc12e758eba77668d3f2e19eae8f746e3a46ae35c858609b25d3a6936b420c61c94a751aa1c921365d80a1665541ef34df2eee05336aeef10720b2a9cb26f0b69cdb2fadd3f*/!async function(){"use strict";let e="#9f4e65ff",t="#c7607eff",n="#eb5b84ff",a="#F68802",o={useGradient:!1,syncedAlertWithTopbar:!1,smoothSidebar:!1,materialDesign:!1,tradeNotifications:!0,itemNotifications:!0,showAds:!0,animatedAlert:!1,darkModeTrades:!0},r=null;const s=new Map;let i=null,c=null,l=null,d=!1;const u={downNotify:!1};let p=window.location.href.match("https://ecsr.io/Feeds/GetUserFeed"),m=null,f=0;const h={1479:GM_getResourceURL("pawIcon"),985:GM_getResourceURL("americowIcon"),111:GM_getResourceURL("chudIcon"),1841:GM_getResourceURL("chiraqIcon"),1173:GM_getResourceURL("maticIcon")},g={},b=e=>new Promise(t=>setTimeout(t,e));function y(e){const t=Math.abs(new Date-new Date(e)),n=Math.floor(t/1e3),a=Math.floor(n/86400),o=Math.floor(n%86400/3600),r=Math.floor(n%3600/60),s=n%60;return a>0?`${a}d ${o}h ${r}m`:o>0?`${o}h ${r}m ${s}s`:r>0?`${r}m ${s}s`:`${s}s`}function w({username:e,userId:t,text:n,groupName:a,groupLink:o,image:r,time:s}){const i=document.querySelector("ul.vlist.feeds");if(!i)return console.warn("Feed list not found");const c=document.createElement("li");c.className="list-item";const l=document.createElement("a");l.href=`/users/${t}/profile`,l.className="avatar avatar-headshot-md list-header";const d=document.createElement("img");d.src=r||`/Thumbs/Avatar.ashx?userId=${t}`,d.className="avatar-card-image",d.alt=`${e}'s Avatar`,l.appendChild(d);const u=document.createElement("div");u.className="list-body";const p=document.createElement("p");if(p.className="list-content",a&&o){const e=document.createElement("a");e.href=o,e.textContent=a,p.appendChild(e)}else{const n=document.createElement("a");n.href=`/users/${t}/profile`,n.className="text-name",n.textContent=e,p.appendChild(n)}const m=document.createElement("p");m.className="feedtext linkify",m.textContent=`${n}`;const f=document.createElement("span");f.className="xsmall text-date-hint",f.textContent=s||(new Date).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"});const h=document.createElement("a");h.href="#",h.className="abuse-report-modal";const g=document.createElement("span");g.className="icon-report",h.appendChild(g),u.append(p,m,f,h),c.append(l,u),i.prepend(c)}async function x(){await GM_setValue("primaryColor",e),await GM_setValue("secondaryColor",t),await GM_setValue("accentColor",n),await GM_setValue("alertColor",a);for(const[e,t]of Object.entries(o))await GM_setValue(e,!0===t?"True":"False")}const v="00-300-0003-3125";await GM_getValue(v)||await x(),await GM_setValue(v,!0),await async function(){e=await GM_getValue("primaryColor")||e,t=await GM_getValue("secondaryColor")||t,n=await GM_getValue("accentColor")||n,a=await GM_getValue("alertColor")||a;for(const e of Object.keys(o))o[e]="True"===await GM_getValue(e)||o[e]}();function C(){const e=Array.from(m.children);let t=0;e.forEach(e=>{const n=e.scrollWidth;n>t&&(t=n)}),e.forEach((n,a)=>{n.style.width=`${t}px`;let o=a>0?"4px":"12px",r=a<e.length-1?"4px":"12px";n.style.borderRadius=`${o} ${o} ${r} ${r}`})}function E(e,t={}){if(p)return;const n=void 0===t.duration?3e3:t.duration,a=t.bgColor||"rgba(30,30,30,0.6)",o=t.textColor||"#fff",r=t.glowColor||"#fff",s=t.icon||null,i=t.redirect||null,c=document.createElement("div");if(Object.assign(c.style,{display:"flex",alignItems:"center",background:a,color:o,padding:"12px 24px",fontFamily:"sans-serif",fontSize:"16px",opacity:0,transform:"translateY(-50px)",transition:"transform 0.4s ease, opacity 0.4s ease, border-radius 0.3s ease, width 0.3s ease",pointerEvents:"auto",boxShadow:`0 0 2px ${r}44, 0 0 6px ${r}33, 0 0 12px ${r}22, 0 0 24px ${r}11`,backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",gap:"12px",whiteSpace:"nowrap",boxSizing:"border-box",overflow:"hidden"}),s){const e=document.createElement("img");e.src=s,Object.assign(e.style,{width:"24px",height:"24px",objectFit:"contain"}),c.appendChild(e)}i&&(c.addEventListener("click",()=>window.open(i,"_blank")),c.href=i);const l=document.createElement("span");l.textContent=e,c.appendChild(l),m.appendChild(c),requestAnimationFrame(()=>{const e=c.offsetWidth;e>f&&(f=e),C(),c.style.opacity=1,c.style.transform="translateY(0)"}),n>0&&setTimeout(()=>{c.style.opacity=0,c.style.transform="translateY(-50px)",c.addEventListener("transitionend",()=>{c.remove(),f=Math.max(...Array.from(m.children).map(e=>e.offsetWidth),0),C()},{once:!0})},n)}function k(e){const t=[],n=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,null,!1);let a;for(;a=n.nextNode();)a.nodeValue.trim()===e&&t.push(a.parentElement);return t}!function(){const r={"--bs-theme-secondary":o.useGradient?`linear-gradient(135deg, ${e} 0%, ${t} 50%, ${n} 100%)`:e,"--bs-theme":o.useGradient?`linear-gradient(180deg, ${e} 0%, ${t} 50%, ${n} 100%)`:e,"--bs-topbar":o.useGradient?`linear-gradient(0deg, ${e} 0%, ${t} 50%, ${n} 100%)`:e,"--bs-alert":o.useGradient&&o.syncedAlertWithTopbar?`linear-gradient(0deg, ${e} 0%, ${t} 50%, ${n} 100%)`:a,"--bs-theme-icon":"rgb(233, 233, 233)","--bs-theme-href":"#8bb5e2","--bs-theme-labels":"rgb(246, 246, 246)"},s=Object.entries(r).map(([e,t])=>`  ${e}: ${t};`).join("\n");GM_addStyle(`\n:root {\n${s}\n}\n.col-lg-8 { flex: 0 0 auto; width: 66.66666667%; background: rgba(0,0,0,0); }\n.body { background-color: rgba(0,0,0,0); }\na, html a, p > a { color: var(--bs-theme-secondary); text-decoration:none !important; cursor: pointer; }\n.fw-bolder { font-weight: normal !important; }\np, div, span, a, h1, h2, h3, button { font-weight: lighter !important; }\n.count-d29-0-2-169, .count-d29-0-2-169, .upgradeNowButton-d8-0-2-158 { background: var(--bs-theme) }\ndiv[class*="alertBg"] { background-repeat: repeat; background-size: 2200px 100px; background: var(--bs-alert); background-blend-mode: normal; }\ndiv[class*="alertText"] { background: rgba(0,0,0,0) !important; }\np[class*="upgradeNowButton"], div[id*="LabelAnnouncement"], div[id*="SystemAlertDiv"] { background: var(--bs-theme) !important; color: var(--bs-theme-labels) !important; }\nnav[class*="navbar fixed"] { background: var(--bs-topbar) !important; }\nbutton[class*="buyButton"],button[class*="defaultBg"] { background: var(--bs-topbar) !important; border-radius:3px; border:0; }\na[href*="/"]:not([class*="linkEntry"], [class*="text-white"], [class*="alertLink"]), a[href*="#"]:not([class*="linkEntry"], [class*="text-white"], [class*="alertLink"]) { color: var(--bs-theme-href) !important; }\nspan[class*="count"]:not([class*="countWrapper"], [class*="accountInfoValue"]), button[class*="buttons_legacyButton"] { background: var(--bs-theme) !important; color: var(--bs-theme-labels) !important; }\noption[class*="option"], option[class*="dropWrapper"] { background: rgb(10,10,10) !important; }\nspan[class*="labelBg"] { background: rgba(0,0,0,0) !important; }\nimg[class*="adImage"] { background: rgb(1,1,1) !important; }\n`),o.smoothSidebar&&GM_addStyle('\ndiv[class*="navIcons"] {\n  transition: transform 0.25s linear, background 0.5s ease-in;\n  transform: translate(-115px, 0px);\n  background: linear-gradient(90deg, rgb(25,26,31), rgba(25,26,31,0.7));\n}\ndiv[class*="navIcons"]:hover {\n  transform: translate(0px, 0px);\n  background: linear-gradient(90deg, rgb(25,26,31), rgba(25,26,31,1.0));\n}'),o.animatedAlert&&GM_addStyle('\ndiv[class*="alertBg"] { height: 40px; bottom-padding: 10; margin-bottom: 10px; }\na[class*="alertLink"] { position: absolute; transform: translate(0px, -5px); white-space: nowrap; animation: moveText 20s ease-in-out infinite; }\n@keyframes moveText { 0% { left: -100%; } 100% { left: 100%; } }'),o.materialDesign&&GM_addStyle('\n:root{--shadow-color: rgba(13,11,11,0.6)}\nnav[id*="sidebarMenu"], div[class*="gamesContainer"], div[class*="gameContainer"], div[class*="default-error-page"], header[class*="navbar navbar-dark sticky-top"] {\n  background: rgba(18,18,21,0.25) !important;\n  box-shadow: 0 10px 20px var(--shadow-color);\n  backdrop-filter: blur(10px);\n  -webkit-backdrop-filter: blur(10px);\n  border-radius: 6px;\n}\ndiv[class*="dropdown"]:not([class*="dropdownEntry"]), div[class*="vTab"], div[class*="card"]:not([class*="gameCard"]), div[class*="imageBig"]{\n  background: rgba(18,18,21,0.25) !important;\n  box-shadow: 0 10px 20px var(--shadow-color);\n  backdrop-filter: blur(10px);\n  -webkit-backdrop-filter: blur(10px);\n  border-radius: 6px;\n}')}(),window.location.href.match("https://ecsr.io/Trade/TradeWindow.aspx")&&u.forceTradeDarkMode&&GM_addStyle('\ndiv[class*=\'container\'],div[class*=\'offerRequestCard\'],div[class*="itemCard"],div[class*="itemOpenEntry"] { background: rgb(13,13,13) !important; }\nimg[class*=\'placeholderImage\'] { background-color: #141414 !important; }\ndiv[class*=\'offerRequestCard\'],div[class*="itemCard"] { border: 1px solid rgba(16,16,16,1); }\ninput,select { background: rgba(16,16,16,1) !important; color: rgb(255,255,255) !important; border: 1px solid rgba(16,16,16,1); border-radius:3px; }\np,h3,span[class*="fw"] { color: rgba(255,254,254,1) !important; }\nbutton[class*="cancelButton"] { background: linear-gradient(0deg, rgba(32,32,32,1) 0%, rgba(55,55,55,1) 100%) !important; border:1px solid rgba(16,16,16,1); color:#fff; }\nbutton:not([class*="cancelButton"]) { background: rgb(12,12,12) !important; }'),m||(m=document.createElement("div"),m.id="notification-container",Object.assign(m.style,{position:"fixed",top:"10px",left:"50%",transform:"translateX(-50%)",display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",zIndex:9999,pointerEvents:"none"}),document.body.appendChild(m)),setTimeout(()=>{if(p)return;const t=GM_info.script.version;GM_xmlhttpRequest({method:"GET",url:"https://raw.githubusercontent.com/ravegirls/BetterECS/refs/heads/main/source.user.js",onload:n=>{const a=n.responseText.match(/@version\s+([^\s]+)/);if(!a)return console.log("Could not find remote version.");const o=a[1],r=function(e,t){const n=(e||"").split(".").map(Number),a=(t||"").split(".").map(Number);for(let e=0;e<Math.max(n.length,a.length);e++){const t=n[e]||0,o=a[e]||0;if(t>o)return 1;if(t<o)return-1}return 0}(o,t);r>0?(E(`You need to update! ${t} → ${o}`,{bgColor:"#0606066e",glowColor:e,duration:5e3}),new Notification("ECS:R",{body:"You need to update!",duration:15})):r<0&&(E(`Experimental build, expect issues! ${o} → ${t}`,{bgColor:"#0606066e",glowColor:e,duration:5e3}),new Notification("ECS:R",{body:"Experimental build!",duration:15}))},onerror:e=>console.error("Failed to fetch remote script:",e)})},100),window.showNotification=function({title:e="Notification",text:t="",image:n="",duration:a=5e3,onClickCallback:o=null}){function r(){const r=new Notification(e,{body:t,icon:n||void 0});o&&"function"==typeof o&&(r.addEventListener("click",()=>{o(),r.close()}),r.addEventListener("focus",()=>{o(),r.close()})),a>0&&setTimeout(()=>r.close(),a)}"Notification"in window?"default"===Notification.permission?Notification.requestPermission().then(e=>"granted"===e&&r()):"granted"===Notification.permission?r():console.warn("Notifications permission denied"):alert("This browser does not support desktop notifications.")};let $=setInterval(()=>{const e=k("Admin Panel");e.length&&(e.forEach(e=>e.innerHTML="NUKE SITE BUTTON"),clearInterval($))},60),N=setInterval(()=>{const e=k("Management");e.length&&(e.forEach(e=>e.remove()),clearInterval(N))},60);async function S(e,t={}){t.headers=t.headers||{},r&&(t.headers["x-csrf-token"]=r);let n=await fetch(e,t);if(403===n.status){const a=n.headers.get("x-csrf-token");a&&(r=a,t.headers["x-csrf-token"]=r,n=await fetch(e,t))}return n}async function I(e){const t={items:[{itemType:"Asset",id:e}]},n={method:"POST",headers:{accept:"application/json, text/plain, */*","accept-language":"en-US,en;q=0.5","content-type":"application/json",priority:"u=1, i","sec-ch-ua":'"Chromium";v="140", "Not=A?Brand";v="24", "Brave";v="140"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin",cookie:document.cookie,"sec-gpc":"1"},body:JSON.stringify(t),mode:"cors",credentials:"include",referrer:`https://ecsr.io/catalog/${e}/redirected?red=true&allow=[0]`},a=await S("https://ecsr.io/apisite/catalog/v1/catalog/items/details",n);if(!a.ok)throw new Error(`Request failed with status: ${a.status}`);return a.json()}!function e(t,n){const a=setInterval(()=>{const o=k("Settings");o.length&&(o.forEach(a=>{if(a.className&&!a.className.match("text-white"))return;const o=a.parentElement.cloneNode(!0),r=o.firstChild;r.textContent=t,r.onclick=n,r.removeAttribute("href"),a.parentElement.parentElement.appendChild(o);const s=setInterval(()=>{0!=k(t).length&&a.parentElement||(clearInterval(s),e(t,n))},30)}),clearInterval(a))},30)}("Configuration",function(){if(window.hasConfigOpen)return E("A configuration menu currently exists!");window.hasConfigOpen=!0,GM_addStyle(".dg.ac { position: absolute !important; z-index: 9999 !important; }"),(async()=>{let r=0;const s=setInterval(()=>{const e=document.getElementsByClassName("default-error-page");e.length&&e[0].remove(),r+=1,r>=2&&clearInterval(s)},200),i=document.createElement("script");i.type="application/javascript",i.innerHTML=GM_getResourceText("imGui"),document.head.appendChild(i);const c=new dat.GUI({name:"ECSR Configuration",hideable:!1}),l={};function d(e,t,n){l[e]=t;c.addColor(l,e).onChange(n)}try{d("primary color",e.slice(0,7),t=>e=t),d("secondary color",t.slice(0,7),e=>t=e),d("accent color",n.slice(0,7),e=>n=e),d("alert color",a.slice(0,7),e=>a=e)}catch{e="#9f4e65ff",t="#c7607eff",n="#eb5b84ff",a="#F68802",d("primary color",e.slice(0,7),t=>e=t),d("secondary color",t.slice(0,7),e=>t=e),d("accent color",n.slice(0,7),e=>n=e),d("alert color",a.slice(0,7),e=>a=e)}Object.entries(o).forEach(([e,t])=>{try{a=t,r=t=>o[e]=t,l[n=e]=a,c.add(l,n).onChange(r)}catch{}var n,a,r}),c.add({save:()=>{x(),E("Saving config...",{glowColor:e}),setTimeout(()=>window.location.assign("https://ecsr.io/home"),500)}},"save").name("save configuration"),c.add({revert:()=>{setTimeout(()=>window.location.assign("https://ecsr.io/home"),10)}},"revert").name("revert changes");const u=k("Close Controls");u.length&&u.forEach(e=>{e.textContent="close";const t=setInterval(()=>{"close"!==e.textContent&&(window.location.assign("https://ecsr.io/home"),e.textContent="open...",clearInterval(t))},100)})})()}),S("https://ecsr.io/apisite/groups/v1/groups/2/rolesets/255");try{I("103796")}catch{new Notification("ECS:R",{body:"Failed to correctly load item data for CSRF Token",duration:1e4})}async function T(e){const t=await fetch(`https://ecsr.io/apisite/thumbnails/v1/users/avatar-headshot?userIds=${e}&size=420x420&format=png`);if(!t.ok)throw new Error(`Failed to fetch headshot for ${e}: ${t.status}`);const n=await t.json();return n.data?.[0]?.imageUrl||null}async function M(){if(o.tradeNotifications)try{const t=await fetch("https://ecsr.io/apisite/trades/v1/trades/inbound?cursor=");if(!t.ok)throw new Error("Failed to fetch inbounds");const n=await t.json(),a=JSON.stringify(n.data);if(i!==a){const t=n.data||[],a={},o={};let r=!0,s=-1;for(let e=0;e<t.length;e++){const n=t[e],i=n.user.id,c=n.user.displayName;-1===s?s=i:i!==s&&(r=!1),a[i]=(a[i]||0)+1,o[c]||(o[c]=n.user)}if(r&&t.length){const n=t[0],o=await fetch(`https://ecsr.io/apisite/thumbnails/v1/users/avatar-headshot?userIds=${n.user.id}&size=420x420&format=png`),r=(await o.json()).data[0].imageUrl,s=a[n.user.id];E(s<=1?`New inbound from ${n.user.displayName}`:`${s} new inbounds from ${n.user.displayName}`,{icon:r,bgColor:"#0606066e",glowColor:e,duration:5e3,redirect:"https://ecsr.io/My/Trades.aspx"})}else{let t,n=0,r=[];if(Array.isArray(o)?r=o.map(e=>e&&(e.displayName||e.name)||String(e)).filter(Boolean):o&&"object"==typeof o&&(r=Object.values(o).map(e=>e&&(e.displayName||e.name)||String(e)).filter(Boolean)),0===r.length)t="someone";else if(r.length<=2)t=r.join(", ");else{const e=r.length-2;t=`${r[0]}, ${r[1]} and ${e} other${1===e?"":"s"}`}if(Array.isArray(a))for(let e=0;e<a.length;e++)n+=Number(a[e]||0);else if(a&&"object"==typeof a)for(const e in a)Object.prototype.hasOwnProperty.call(a,e)&&(n+=Number(a[e]||0));else n=Number(a)||0;const s=await async function(e){const t=Object.values(e||{}).slice(0,3),n=[];for(const e of t){const t=await T(e.id);n.push({displayName:e.displayName||e.name||"someone",avatar:t})}return n}(o);0!=n&&function(e,t={}){if(p)return;const n=void 0===t.duration?3e3:t.duration,a=t.bgColor||"rgba(30,30,30,0.6)",o=t.textColor||"#fff",r=t.glowColor||"#fff",s=t.redirect||null,i=Array.isArray(t.users)?t.users:[],c=Number(t.maxAvatars)||5,l=Number(t.avatarSize)||28,d=Number(t.overlap)||10,u=document.createElement("div");if(Object.assign(u.style,{display:"flex",alignItems:"center",background:a,color:o,padding:"12px 16px",fontFamily:"sans-serif",fontSize:"16px",opacity:0,transform:"translateY(-50px)",transition:"transform 0.35s ease, opacity 0.35s ease, border-radius 0.25s ease, width 0.25s ease",pointerEvents:"auto",cursor:s?"pointer":"default",boxShadow:`0 0 2px ${r}44, 0 0 6px ${r}33, 0 0 12px ${r}22, 0 0 24px ${r}11`,backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:"12px",gap:"12px",whiteSpace:"nowrap",boxSizing:"border-box",overflow:"hidden"}),i.length>0){const e=document.createElement("div");Object.assign(e.style,{display:"flex",alignItems:"center",marginRight:"8px",position:"relative",height:`${l}px`,pointerEvents:"none"});const t=Math.min(i.length,c);for(let n=0;n<t;n++){const a=i[n],o=document.createElement("img");o.src=a.avatar||a.icon||"",o.alt=a.displayName||"";const r=1-n/t*.5;Object.assign(o.style,{width:`${l}px`,height:`${l}px`,borderRadius:"50%",objectFit:"cover",border:"2px solid rgba(0,0,0,0.35)",boxShadow:"0 1px 3px rgba(0,0,0,0.4)",marginLeft:0===n?"0px":`-${d}px`,opacity:r.toString(),zIndex:""+(10+t-n),display:"block"}),o.addEventListener("load",C),o.addEventListener("error",C),e.appendChild(o)}if(i.length>c){const n=document.createElement("div"),a=i.length-c;n.textContent=`+${a}`,Object.assign(n.style,{width:`${l}px`,height:`${l}px`,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",marginLeft:`-${d}px`,zIndex:`${10+t}`,background:"rgba(0,0,0,0.35)",color:"#fff",fontSize:"12px",border:"2px solid rgba(0,0,0,0.35)"}),e.appendChild(n)}u.appendChild(e)}const f=document.createElement("span");f.textContent=e,f.style.pointerEvents="auto",u.appendChild(f),s&&u.addEventListener("click",()=>window.open(s,"_blank")),m.appendChild(u),requestAnimationFrame(()=>{C(),requestAnimationFrame(()=>{u.style.opacity=1,u.style.transform="translateY(0)"})}),n>0&&setTimeout(()=>{u.style.opacity=0,u.style.transform="translateY(-50px)",u.addEventListener("transitionend",()=>{u.remove(),C()},{once:!0})},n)}(`${n>9?"9+":String(n)} new inbounds from ${t}`,{users:s,overlap:15,bgColor:"#0606066e",glowColor:e,duration:5e3,redirect:"https://ecsr.io/My/Trades.aspx"})}}i=a,c=n.data}catch(e){}}M(),setInterval(M,7500);async function L(){if(o.itemNotifications)try{const t=await fetch("https://ecsr.io/apisite/catalog/v1/search/items?category=all&limit=28&sortType=0&subcategory=all");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const n=await t.json();let a=JSON.stringify(n.data);if(d&&u.downNotify&&(new Notification("ECS:R",{body:"ECS:R is no longer under maintenance!",duration:5500}),d=!1),null===l)a={};else if(l!==a){const t=n.data[0].id;if(GM_getValue("droppedE_"+t))return;GM_setValue("droppedE_"+t,"hi");const a=await fetch("https://ecsr.io/apisite/thumbnails/v1/assets?assetIds="+t);if(!a)return console.error("Failed to get thumbnailData");const o=(await I(t)).data[0],r=(await a.json()).data[0].imageUrl,s=o.price,i=o.name;if(1!=o.creatorTargetId)return;const c=["LimitedUnique","Limited"].includes(o.itemRestrictions[0]);let l=null==s?"N/A":`${s} ROBUX`;null!=o.priceTickets&&(l=`${l} / ${o.priceTickets} TIX`);let d=`Price: ${l}`;if(c)if(null!=o.unitsAvailableForConsumption)d=`Price: ${l}\nStock: ${o.unitsAvailableForConsumption}\nLimited: true`;else{let e="";o.offsaleDeadline&&(e=`\nPeriod: ${y(o.offsaleDeadline)}`),d=`Price: ${l}\nLimited: true`+e}else o.offsaleDeadline&&(d=`Price: ${l}\nPeriod: ${y(o.offsaleDeadline)}`);const u={title:i,body:d,image:r,duration:-1,onClickCallback:async function(){window.focus(),await GM_setValue("promptPurchase",String(t));const e=window.open("https://ecsr.io/catalog/"+t+"/--?promptPurchase=true","__eacf63");e.onload=()=>e.promptPurchase=!0}};E("New drop! "+i,{icon:r,bgColor:"#0606066e",glowColor:e,duration:5e3});const p=new Notification(u.title,u);p.addEventListener("click",()=>{u.onClickCallback(),p.close()}),p.addEventListener("focus",()=>{u.onClickCallback(),p.close()})}l=a}catch(e){!d&&u.downNotify&&(new Notification("ECS:R",{body:"ECS:R is under maintenance!",duration:5500}),d=!0),console.error("Fetch error:",e)}}setInterval(L,750),L(),setTimeout(async()=>{if(!window.location.href.match("https://ecsr.io/catalog/"))return;const e=Array.from(document.querySelectorAll("p")).find(e=>e.textContent.includes("Sold")),t=e?.querySelector("span.text-white"),n=window.location.href.replace("https://ecsr.io/catalog/","").split("/")[0];t&&setInterval(async()=>{try{const e=await fetch(`https://ecsr.io/apisite/inventory/v2/assets/${n}/owners?cursor=0&limit=100&sortOrder=Asc`),a=await e.json();t.textContent=String((await a).data.length-1)}catch(e){}},1e3)},5e3);let A=null;A=setInterval(async function e(){if(!window.location.href.match("https://ecsr.io/My/Trades.aspx"))return;const t=Array.from(document.querySelectorAll("p")).filter(e=>e.textContent.includes("Total RAP"));if(t.length<2)return;clearInterval(A);for(const e of t){const t=e.querySelector('[class*="robuxLabel"]');if(!t)continue;const n=t.parentElement.cloneNode(!0),a=t.parentElement.parentElement,o=n.querySelector('[class*="valueLabel"]'),r=n.querySelector('[class*="robuxLabel"]'),i=n.querySelector('[class*="robuxIconLg"]');if(!(o&&r&&i))continue;o.textContent="Total Value:",r.textContent="WAITING FOR ITEMS...",r.style.color="rgb(96,165,250)",i.src=GM_getResourceURL("valueIcon"),a.appendChild(n),a.style.display="flex",a.style.flexDirection="row";let c=e.closest(".row")?.nextElementSibling,l=c?c.querySelectorAll('a[href*="/catalog/"]'):[];for(;0===l.length;)c||(c=e.closest(".row")?.nextElementSibling),l=c?c.querySelectorAll('a[href*="/catalog/"]'):[],await b(150);r.textContent="Calculating...";const d=Array.from(l).map(e=>({name:e.textContent.trim(),href:e.href,object:e}));Array.from(l).forEach(e=>{if(!e.querySelector(".valueOverlay")){const t=document.createElement("div");t.classList.add("valueOverlay"),t.textContent="Item Value",Object.assign(t.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",fontWeight:"bold",textAlign:"center",pointerEvents:"none",opacity:"0"}),e.appendChild(t),e.parentElement.parentElement.addEventListener("mouseenter",()=>t.style.opacity="1"),e.parentElement.parentElement.addEventListener("mouseleave",()=>t.style.opacity="0")}});let u=0;const p=d.map(async e=>{try{const t=e.href.replace("https://ecsr.io/catalog/","").split("/")[0];let n;if(s.has(t))n=s.get(t);else{const e=await fetch(`https://ecomons.xyz/api/items/${t}?owners=true`),a=await e.json();n=a.db?.value||0,0==n&&(n=a.ecsr?a.ecsr[0].rap:0),s.set(t,n)}const a=e.object.parentElement.getElementsByClassName("valueOverlay")[0];return a&&(a.textContent=n),u+=n,{...e,value:n}}catch{return{...e,value:0}}});await Promise.all(p),r.textContent=u.toLocaleString()}const n=setInterval(()=>{const t=document.querySelector('[class*="valueLabel"]');t&&t.parentElement||(clearInterval(n),e(),A=setInterval(e,1e3))},100)},1e3);setInterval(()=>{if(!window.location.href.match("https://ecsr.io/home"))return;const e=document.querySelector('[class*="helloMessage"]');e&&(e.innerHTML=e.innerHTML.replace("Hello",function(){const e=(new Date).getHours();return e>=5&&e<12?"Morning":e>=12&&e<18?"Afternoon":"Night"}()))},50);const G=e=>`https://ecsr.io/apisite/users/v1/users/${e}`;for(const[e,t]of Object.entries(h))try{const n=await fetch(G(e)),a=await n.json();a?.name&&(g[a.name]={id:Number(e),name:a.name,img:t})}catch(t){console.warn("Failed to fetch user",e,t)}if(setInterval(function(){document.querySelectorAll("span.icon-verified, span.icon-obc").forEach(e=>{const t=e.closest("p, h2, h3, div, span");if(!t)return;const n=function(e){return Array.from(e.childNodes).filter(e=>e.nodeType===Node.TEXT_NODE&&e.textContent.trim().length>0).map(e=>e.textContent.trim()).join("").toLowerCase()}(t.parentElement),a=g[n];var o,r;if(a)if(e.classList.contains("icon-verified")){e.style["background-image"]=`url('${a.img}')`;try{e.parentElement.childNodes.forEach(e=>{e&&e.className&&e.className.match("icon-obc")&&(e.style.opacity="0")})}catch(e){console.log(e)}}else"0"!=e.style.opacity&&(o=e,r=a.img,o.style.cssText=`\n            padding-left: 32px;\n            top: 2.5px;\n            position: relative;\n            background-image: url('${r}');\n            background-size: contain;\n            background-repeat: no-repeat; \n            background-position: 50%;\n            width: 20px;\n            height: 20px;\n            display: inline-block;\n        `,o.dataset.replaced="true"),e.style["background-image"]=`url('${a.img}')`})},100),setTimeout(()=>{let t=!1;try{const e=GM_getValue("promptPurchase");e&&window.location.href.match(e)&&(t=!0)}catch{}if(window.promptPurchase||t){let t=setInterval(()=>{let n=k("Buy with R$");n.length&&0!=n.length||(n=k("Buy with Tx")),n.length&&0!=n.length&&(n[0].click(),E("Prompting purchase!",{glowColor:e}),clearInterval(t))},200)}},300),p){let e="";Object.values(g).forEach((t,n)=>{1479==t.id&&(e=t.name?t.name:"failed to fetch")}),w({username:"Better ECS",userId:1479,text:`Created with love by ${e} aka bella (v${GM_info.script.version})`,image:GM_getResourceURL("pawIcon")}),w({username:"Better ECS",userId:1479,text:"Welcome to BetterECS! Thank you for using my extension :3",image:GM_getResourceURL("pawIcon")})}}();