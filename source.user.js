// ==UserScript==
// @name         BetterECS
// @namespace    http://tampermonkey.net/
// @version      0.0.31
// @description  Economy Simulator Overhaul Plugin (Dev)
// @author       isabella
// @match        https://ecsr.io/*
// @grant        GM_addStyle
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_getResourceURL
// @grant        GM_getResourceText
// @grant        GM_deleteValue
// @grant        GM_xmlhttpRequest
// @updateURL    https://raw.githubusercontent.com/ravegirls/BetterECS/refs/heads/main/source.user.js
// @downloadURL  https://raw.githubusercontent.com/ravegirls/BetterECS/refs/heads/main/source.user.js
// @resource     notify https://cdn.pixabay.com/download/audio/2025/06/22/audio_76f254e734.mp3?filename=new-notification-014-363678.mp3
// @resource     errorIcon https://cdn-icons-png.flaticon.com/512/1828/1828843.png
// @resource     infoIcon https://cdn-icons-png.flaticon.com/512/1828/1828817.png
// @resource     frutigerGif https://imgs.search.brave.com/7mRlFUU09XpY94SiqyxlmhER3UnemBu4Y9j2ejnTQ4o/rs:fit:860:0:0:0/g:ce/aHR0cHM6Ly9pLnBp/bmltZy5jb20vb3Jp/Z2luYWxzLzAxL2Uy/L2VmLzAxZTJlZjg5/ZjA5ZDhhNWU3OGNj/ZGNhMzRmZTU5MDI2/LmdpZg.gif
// @resource     oldBackground https://cdn.discordapp.com/attachments/1344823831784587295/1415866330933891193/roblox_blue_city_bg_by_karagolge_di0jmi2-fullview.png?ex=68c56c86&is=68c41b06&hm=b4715c72d7ba988c7152c5b2f98a4677471f37cf0d92d151b61cb225ff6cf8e1
// @resource     popperJs https://unpkg.com/@popperjs/core@2/dist/umd/popper.min.js
// @resource     tippyJs https://unpkg.com/tippy.js@6/dist/tippy-bundle.umd.js
// @resource     pickrJs https://cdn.jsdelivr.net/npm/@simonwep/pickr@1.8.0/dist/pickr.min.js
// @resource     pickrCss https://cdn.jsdelivr.net/npm/@simonwep/pickr@1.8.0/dist/themes/classic.min.css
// @resource     tippyCss https://unpkg.com/tippy.js@6/dist/tippy.css
// @resource     imGui https://cdn.jsdelivr.net/npm/dat.gui@0.7.7/build/dat.gui.min.js
// @resource     valueIcon https://github.com/ravegirls/eco_assets/blob/main/img-robux.png?raw=true
// @resource     verificationHeartTick https://imgs.search.brave.com/l46S-kt9zc8lNllaFOq0tUvzTtJt6n8cx2fwhM0xOms/rs:fit:860:0:0:0/g:ce/aHR0cHM6Ly9zeW1i/bC1jZG4uY29tL2kv/d2VicC82Ny81NWIx/NzY1ODQ1NzE1M2Vl/N2JlNWY4NWYwMzI1/YTIud2VicA
// @resource     nyanCatTick https://imgs.search.brave.com/5AusP691t8poCdvbch7M2hmONE7-VLaJ_vdVYvLwM8s/rs:fit:860:0:0:0/g:ce/aHR0cHM6Ly93d3cu/cnctZGVzaWduZXIu/Y29tL2ljb24taW1h/Z2UvMjAzNjctMjU2/eDI1NngzMi5wbmc
// @resource     pawIcon https://imgs.search.brave.com/sqEYsC0AHS_vBtjfOo5kEv0YajnvfvfO0FQRr0ZGqwI/rs:fit:860:0:0:0/g:ce/aHR0cHM6Ly9pLnBp/bmltZy5jb20vb3Jp/Z2luYWxzLzQyLzE3/L2FkLzQyMTdhZDBk/ZTg5MWYwZjU4YzNj/OWI5N2UyMTgxNGZk/LmpwZw
// @resource     discordIcon https://imgs.search.brave.com/mRHkIaGFNtQ-vkIukHc9y2D28x34KVTs9Luu59lty6s/rs:fit:860:0:0:0/g:ce/aHR0cHM6Ly9jZG4t/aWNvbnMtcG5nLmZs/YXRpY29uLmNvbS8x/MjgvNDk0NS80OTQ1/OTczLnBuZw
// ==/UserScript==
/*16b533e4787b6c32e1789c51aa000fefa18974fbe2ee531ee85919585e1be90a2ed30d76f595e1ae733178d2a4324526306bbe1689d2fc5ea8be0b2bc1c11df70ea5c38224a099a44b98089a3cdcd68a4689d56fc9f5ca0a7ff21190402b1f61ad010a48184d4dbbe2b1917f17a7be6b2bd99edbd3dd1ccdb87189d46fe7a4cc*/!async function(){"use strict";function e(e){const t=Math.abs(new Date-new Date(e)),n=Math.floor(t/1e3),o=Math.floor(n/86400),a=Math.floor(n%86400/3600),r=Math.floor(n%3600/60),i=n%60;return o>0?`${o}d ${a}h ${r}m`:a>0?`${a}h ${r}m ${i}s`:r>0?`${r}m ${i}s`:`${i}s`}function t(e){return new Promise(t=>setTimeout(t,e))}setTimeout(()=>{const e=GM_info.script.version;GM_xmlhttpRequest({method:"GET",url:"https://raw.githubusercontent.com/ravegirls/BetterECS/refs/heads/main/source.user.js",onload:t=>{const o=t.responseText.match(/@version\s+([^\s]+)/);if(!o)return console.log("Could not find remote version.");const a=o[1];console.log("Local version:",e),console.log("Remote version:",a);const r=function(e,t){const n=e.split(".").map(Number),o=t.split(".").map(Number);for(let e=0;e<Math.max(n.length,o.length);e++){const t=n[e]||0,a=o[e]||0;if(t>a)return 1;if(t<a)return-1}return 0}(a,e);r>0?C(`You need to update! ${e} → ${a}`,{bgColor:"#0606066e",glowColor:n,duration:5e3}):r<0&&C(`Experimental build, expect issues! ${a} → ${e}`,{bgColor:"#0606066e",glowColor:n,duration:5e3})},onerror:e=>console.error("Failed to fetch remote script:",e)})},100);!function(e){const{r:t,g:n,b:o}=function(e){3===(e=e.replace(/^#/,"")).length&&(e=e.split("").map(e=>e+e).join(""));const t=parseInt(e,16);return{r:t>>16&255,g:t>>8&255,b:255&t}}(e)}("#ffffff");let n="#9f4e65ff",o="#c7607eff",a="#eb5b84ff",r="#F68802",i={useGradient:!1,syncedAlertWithTopbar:!1,smoothSidebar:!1,materialDesign:!1,tradeNotifications:!0,itemNotifications:!0,showAds:!0,animatedAlert:!1};async function s(){await GM_setValue("primaryColor",n),await GM_setValue("secondaryColor",o),await GM_setValue("accentColor",a),await GM_setValue("alertColor",r),Object.entries(i).forEach(async([e,t])=>{await GM_setValue(e,1==t?"True":"False")})}async function l(e){return await GM_getValue(e)}let c="00-300-0003-3125";GM_getValue(c)||s(),GM_setValue(c,!0),await async function(){n=await l("primaryColor"),o=await l("secondaryColor"),a=await l("accentColor"),r=await l("alertColor"),Object.entries(i).forEach(async([e,t])=>{i[e]="True"==await GM_getValue(e)}),console.log(n,o,a,r)}();let d,p,u=document.getElementById("notification-container");if(u||(u=document.createElement("div"),u.id="notification-container",Object.assign(u.style,{position:"fixed",top:"10px",left:"50%",transform:"translateX(-50%)",display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",zIndex:9999,pointerEvents:"none"}),document.body.appendChild(u)),GM_addStyle(`\n .col-lg-8 {\n        flex: 0 0 auto;\n        width: 66.66666667%;\n        background: rgba(0, 0, 0, 0);\n    }\n    .body {\n        background-color: rgba(0, 0, 0, 0);\n    }\n\n    /* topbar */\n    a,\n    html a,\n    p > a {\n        color: var(--bs-theme-secondary);\n        text-decoration: none !important;\n        cursor: pointer;\n    }\n    .fw-bolder {\n        font-weight: normal !important;\n    }\n    p,\n    div,\n    span,\n    a,\n    h1,\n    h2,\n    h3,\n    button {\n        font-weight: lighter !important;\n    }\n\n    :root {\n        --bs-theme-secondary: ${i.useGradient?`linear-gradient(135deg, ${n} 0%, ${o} 50%, ${a} 100%)`:n};\n        --bs-theme: ${i.useGradient?`linear-gradient(180deg, ${n} 0%, ${o} 50%, ${a} 100%)`:n};\n        --bs-topbar: ${i.useGradient?`linear-gradient(0deg, ${n} 0%, ${o} 50%, ${a} 100%)`:n};\n        --bs-alert: ${i.useGradient&&i.syncedAlertWithTopbar?`linear-gradient(0deg, ${n} 0%, ${o} 50%, ${a} 100%)`:r};\n        /*rgba(145, 3, 233, 1) !important;*/\n        --bs-theme-icon: rgb(233, 233, 233) !important;\n        --bs-theme-href: #8bb5e2 !important;\n        --bs-theme-labels: rgb(246, 246, 246) !important;\n        /*--bs-light-rgb: */\n    }\n\n\n    .count-d29-0-2-169,\n    .count-d29-0-2-169,\n    .upgradeNowButton-d8-0-2-158 {\n        background: var(--bs-theme)\n    }\n\n    div[class*="alertBg"] {\n        /* Keep your locked scale stuff */\n        background-repeat: repeat;\n        background-size: 2200px 100px;\n\n        background: var(--bs-alert);\n\n\n        background-blend-mode: normal;\n    }\n\n    div[class*="alertText"] {\n        background: rgba(0, 0, 0, 0) !important;\n    }\n\n    /* announcement color */\n    p[class*="upgradeNowButton"],\n    div[id*="LabelAnnouncement"],\n    div[id*="SystemAlertDiv"] {\n        background: var(--bs-theme) !important;\n        color: var(--bs-theme-labels) !important;\n    }\n    nav[class*="navbar fixed"] {\n        background: var(--bs-topbar) !important;\n    }\n    button[class*="buyButton"],button[class*="defaultBg"] {\n        background: var(--bs-topbar) !important;\n        border-radius: 3px;\n        border: 0px;\n    }\n    a[href*="/"]:not([class*="linkEntry"], [class*="text-white"], [class*="alertLink"]),\n    a[href*="#"]:not([class*="linkEntry"], [class*="text-white"], [class*="alertLink"]) {\n        color: var(--bs-theme-href) !important;\n    }\n    span[class*="count"]:not([class*="countWrapper"], [class*="accountInfoValue"]), button[class*="buttons_legacyButton"] {\n        background: var(--bs-theme) !important;\n        color: var(--bs-theme-labels) !important;\n    }\n\n    option[class*="option"],option[class*="dropWrapper"] {\n        background: rgb(10, 10, 10) !important;\n    }\n\n\n\n    span[class*="labelBg"] {\n        background: rgba(0, 0, 0, 0) !important;\n    }\n\n    img[class*="adImage"] {\n        background: rgb(1, 1, 1) !important;\n    }\n\n\n\n\n  `),window.location.href.match("https://ecsr.io/Trade/TradeWindow.aspx")&&GM_addStyle('\n        div[class*=\'container\'],div[class*=\'offerRequestCard\'],div[class*="itemCard"],div[class*="itemOpenEntry"] {\n            background: rgb(13, 13, 13) !important;\n        }\n        img[class*=\'placeholderImage\'] {\n            background-color: #141414 !important;\n        }\n        div[class*=\'offerRequestCard\'],div[class*="itemCard"] {\n            border: 1px solid rgba(16, 16, 16, 1);\n        }\n        input,select {\n            background: rgba(16, 16, 16, 1) !important;\n            color: rgb(255, 255, 255) !important;\n            border: 1px solid rgba(16, 16, 16, 1);\n            border-radius: 3px;\n        }\n        p,h3,span[class*="fw"] {\n            color: rgba(255, 254, 254, 1) !important;\n        }\n        button[class*="cancelButton"] {\n            background: linear-gradient(0deg, rgba(32, 32, 32, 1) 0%, rgba(55, 55, 55, 1) 100%) !important;\n            border: 1px solid rgba(16, 16, 16, 1);\n            color: rgb(255,255,255);\n        }\n        button:not([class*="cancelButton"]) {\n            background: rgb(12, 12, 12) !important;\n        }\n        '),i.smoothSidebar&&GM_addStyle('\n    div[class*="navIcons"] {\n        transition: transform 0.25s linear, background 0.5s ease-in;\n        transform: translate(-115px, 0px);\n        background: linear-gradient(90deg, rgb(25, 26, 31), rgba(25, 26, 31, 0.7));\n    }\n\n    div[class*="navIcons"]:hover {\n      transform: translate(0px, 0px);\n      background: linear-gradient(90deg, rgb(25, 26, 31), rgba(25, 26, 31, 1.0));\n    }'),i.showAds||setInterval(()=>{document.querySelectorAll('[class*="adImage"]').forEach(e=>{e.remove()})},60),i.animatedAlert&&GM_addStyle('\ndiv[class*="alertBg"] {             height: 40px; bottom-padding: 10; margin-bottom: 10px; }\n              a[class*="alertLink"] {\n            position: absolute;\n            transform: translate(0px, -5px);\n            white-space: nowrap;\n            animation: moveText 20s ease-in-out infinite;\n        }\n\n              @keyframes moveText {\n            0% {\n                left: -100%; /* Starts off-screen to the left */\n            }\n            100% {\n                left: 100%; /* Moves off-screen to the right */\n            }\n        }\n\n        '),i.materialDesign&&GM_addStyle('\n      :root {\n        --shadow-color: rgba(13, 11, 11, 0.6)\n      }\n\n      nav[id*="sidebarMenu"] {\n        background: rgba(18, 18, 21, 0.25) !important;\n        box-shadow: 0 10px 20px var(--shadow-color);\n        backdrop-filter: blur(10px);\n        -webkit-backdrop-filter: blur(10px);\n        border-radius: 6px;\n    }\n\n    div[class*="gamesContainer"],div[class*="gameContainer"],div[class*="default-error-page"],header[class*="navbar navbar-dark sticky-top"] {\n        background: rgba(18, 18, 21, 0.25) !important;\n        box-shadow: 0 10px 20px var(--shadow-color);\n        backdrop-filter: blur(10px);\n        -webkit-backdrop-filter: blur(10px);\n        border-radius: 6px;\n        z-index: 1;\n    }\n\n    div[class*="dropdown"]:not([class*="dropdownEntry"]) {\n        z-index: 3333333333; !important;\n        background: rgba(18, 18, 21, 0.25) !important;\n        box-shadow: 0 10px 20px var(--shadow-color);\n        backdrop-filter: blur(10px);\n        -webkit-backdrop-filter: blur(10px);\n        border-radius: 6px;\n        flex-direction: row;\n        position: relative;\n    }\n\n    div[class*="dropdownEntry"],p[class*="dropdown"] {\n        z-index: 3333333333; !important;\n        position: relative;\n    }\n\n    div[class*="vTab"] {\n        background: rgba(18, 18, 21, 0.25) !important;\n        box-shadow: 0 10px 20px var(--shadow-color);\n        backdrop-filter: blur(10px);\n        -webkit-backdrop-filter: blur(10px);\n        border-radius: 6px 6px 0px 0px;\n\n    }\n\n    div[class*="card"]:not([class*="gameCard"]),div[class*="imageBig"] {\n        background: rgba(18, 18, 21, 0.25) !important;\n        box-shadow: 0 10px 20px var(--shadow-color);\n        backdrop-filter: blur(10px);\n        -webkit-backdrop-filter: blur(10px);\n        border-radius: 6px 6px 6px 6px;\n        padding: 5px;\n\n    }\n\n    div[class*="overviewDetails"]\n  '),window.location&&window.location.href.match("/admin")){(async()=>{if("Notification"in window){await window.Notification.requestPermission()}})()}function m(e){const t=[],n=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,null,!1);let o;for(;o=n.nextNode();)o.nodeValue.trim()===e&&t.push(o.parentElement);return t}d=setInterval(()=>{const e=m("Admin Panel");0!=e.length&&(e.forEach(e=>{e.innerHTML="NUKE SITE BUTTON"}),clearInterval(d))},60),p=setInterval(()=>{const e=m("Management");0!=e.length&&e.forEach(e=>{e.remove()})},60),function e(t,n,o){let a;a=setInterval(()=>{const r=m("Settings");0!=r.length&&(r.forEach(a=>{if(a.className&&!a.className.match("text-white"))return;const r=a.parentElement.cloneNode(!0),i=r.firstChild;let s;i.textContent=t,i.onclick=n,i.removeAttribute("href"),a.parentElement.parentElement.appendChild(r),s=setInterval(()=>{if(0==m(t).length||!a.parentElement)return clearInterval(s),e(t,n,o)},30)}),clearInterval(a))},30)}("Configuration",function(){if(window.hasConfigOpen)return C("A configuration menu currently exists!");window.hasConfigOpen=!0,GM_addStyle("\n        .dg.ac {\n            position: absolute !important;\n            z-index: 9999 !important;\n        }\n    ");let e,t=0;e=setInterval(()=>{const n=document.getElementsByClassName("default-error-page");0!=n.length&&(n[0].remove(),t+=1,t>=2&&clearInterval(e))},200);const l=document.createElement("script");l.type="application/javascript",l.innerHTML=GM_getResourceText("imGui"),document.head.appendChild(l);const c=new dat.GUI({name:"ECSR Configuration",hideable:!1});let d={};async function p(e,t,n){d[e]=t.color,(await c.addColor(d,e)).onChange(n)}p("primary color",{color:n.slice(0,7)},e=>{n=e}),p("secondary color",{color:o.slice(0,7)},e=>{o=e}),p("accent color",{color:a.slice(0,7)},e=>{a=e}),p("alert color",{color:r.slice(0,7)},e=>{r=e}),Object.entries(i).forEach(([e,t])=>{console.log(e,t),async function(e,t,n){d[e]=t.toggle,(await c.add(d,e)).onChange(n)}(e,{toggle:t},t=>{i[e]=t})}),c.add({save:()=>{s(),C("Saving config...",{glowColor:n}),setTimeout(function(){window.location.assign("https://ecsr.io/home")},500)}},"save").name("save configuration"),c.add({revert:()=>{setTimeout(function(){window.location.assign("https://ecsr.io/home")},10)}},"revert").name("revert changes");const u=m("Close Controls");0!=u.length&&u.forEach(e=>{let t;e.textContent="close",t=setInterval(function(){"close"!=e.textContent&&(window.location.assign("https://ecsr.io/home"),e.textContent="open...",clearInterval(t))},100)})}),window.location&&window.location.href,window.showNotification=function({title:e="Notification",text:t="",image:n="",duration:o=5e3,onClickCallback:a=null}){function r(){const r=new Notification(e,{body:t,icon:n||void 0});a&&"function"==typeof a&&(r.addEventListener("click",()=>{a(),r.close()}),r.addEventListener("focus",()=>{a(),r.close()})),o>0&&setTimeout(()=>{r.close()},o)}"Notification"in window?"default"===Notification.permission?Notification.requestPermission().then(e=>{"granted"===e&&r()}):"granted"===Notification.permission?r():console.warn("Notifications permission denied"):alert("This browser does not support desktop notifications.")};const f=!1;let g=null,h=!1,b=null;async function w(e,t={}){t.headers=t.headers||{},b&&(t.headers["x-csrf-token"]=b);let n=await fetch(e,t);if(403===n.status){const o=n.headers.get("x-csrf-token");console.log(o),o&&(b=o,t.headers["x-csrf-token"]=b,n=await fetch(e,t))}return n}async function x(e){const t={items:[{itemType:"Asset",id:e}]},n={method:"POST",headers:{accept:"application/json, text/plain, */*","accept-language":"en-US,en;q=0.5","content-type":"application/json",priority:"u=1, i","sec-ch-ua":'"Chromium";v="140", "Not=A?Brand";v="24", "Brave";v="140"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin",cookie:document.cookie,"sec-gpc":"1"},body:JSON.stringify(t),mode:"cors",credentials:"include",referrer:`https://ecsr.io/catalog/${e}/redirected?red=true&allow=[0]`};try{const e=await w("https://ecsr.io/apisite/catalog/v1/catalog/items/details",n);if(!e.ok)throw new Error(`Request failed with status: ${e.status}`);const t=await e.json();return console.log("Success:",t),t}catch(e){throw console.error("Error:",e),e}}w("https://ecsr.io/apisite/groups/v1/groups/2/rolesets/255");try{x("103796")}catch{window.showNotification({title:"ECS:R",text:"Failed to correctly load item data for CSRF Token",duration:1e4})}function y(){const e=Array.from(u.children);let t=0;e.forEach(e=>{const n=e.scrollWidth;n>t&&(t=n)}),e.forEach((n,o)=>{n.style.width=`${t}px`;let a="12px",r="12px";o>0&&(a="4px"),o<e.length-1&&(r="4px"),n.style.borderRadius=`${a} ${a} ${r} ${r}`})}let v=0;function C(e,t={}){const n=t.duration||3e3,o=t.bgColor||"rgba(30,30,30,0.6)",a=t.textColor||"#fff",r=t.glowColor||"#fff",i=t.icon||null,s=t.redirect||null,l=document.createElement("div");if(Object.assign(l.style,{display:"flex",alignItems:"center",background:o,color:a,padding:"12px 24px",fontFamily:"sans-serif",fontSize:"16px",opacity:0,transform:"translateY(-50px)",transition:"transform 0.4s ease, opacity 0.4s ease, border-radius 0.3s ease, width 0.3s ease",pointerEvents:"auto",boxShadow:`\n            0 0 2px ${r}44,\n            0 0 6px ${r}33,\n            0 0 12px ${r}22,\n            0 0 24px ${r}11\n      `,backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"12px",gap:"12px",whiteSpace:"nowrap"}),i){const e=document.createElement("img");e.src=i,Object.assign(e.style,{width:"24px",height:"24px",objectFit:"contain"}),l.appendChild(e)}s&&(l.addEventListener("click",()=>{window.open(s,"_blank")}),l.href=s);const c=document.createElement("span");c.textContent=e,l.appendChild(c),u.appendChild(l),requestAnimationFrame(()=>{const e=l.offsetWidth;e>v&&(v=e),y(),l.style.opacity=1,l.style.transform="translateY(0)"}),setTimeout(()=>{l.style.opacity=0,l.style.transform="translateY(-50px)",l.addEventListener("transitionend",()=>{l.remove(),v=Math.max(...Array.from(u.children).map(e=>e.offsetWidth),0),y()})},n)}async function k(e){const t=await fetch(`https://ecsr.io/apisite/thumbnails/v1/users/avatar-headshot?userIds=${e}&size=420x420&format=png`);if(!t.ok)throw new Error(`Failed to fetch headshot for ${e}: ${t.status}`);const n=await t.json();return n.data?.[0]?.imageUrl||null}setTimeout(()=>{let e=!1;if(GM_getValue("promptPurchase")){let t=GM_getValue("promptPurchase");window.location.href.match(t)&&(e=!0)}if(console.log(GM_getValue("promptPurchase"),window.promptPurchase),window.promptPurchase||e){let e;e=setInterval(()=>{const t=m("Buy with R$");0!=t.length&&(t[0].click(),C("Prompting purchase!",{glowColor:n}),clearInterval(e))},200)}},300);let E=null,$=null;async function S(){if(i.tradeNotifications)try{const e=await fetch("https://ecsr.io/apisite/trades/v1/trades/inbound?cursor=");if(!e.ok)throw new Error("Failed to fetch inbounds");const t=await e.json();let o=JSON.stringify(t.data);if(E!=o){let e=t.data,o={},a={},r=!0,i=-1;console.log(e);for(let t=0;t<e.length;t++){const n=e[t],s=n.user.id,l=n.user.displayName;-1===i?i=s:s!==i&&(r=!1),o[s]||(o[s]=0),o[s]++,a[l]||(a[l]=n.user)}if(console.log(o,a),r){let t=e[0],a=await fetch(`https://ecsr.io/apisite/thumbnails/v1/users/avatar-headshot?userIds=${t.user.id}&size=420x420&format=png`),r=(await a.json()).data[0].imageUrl,i=o[t.user.id];C(i<=1?`New inbound from ${t.user.displayName}`:`${i} new inbounds from ${t.user.displayName}`,{icon:r,bgColor:"#0606066e",glowColor:n,duration:5e3,redirect:"https://ecsr.io/My/Trades.aspx"})}else{let e,t=0,r=[];if(Array.isArray(a)?r=a.map(e=>e&&(e.displayName||e.name)||String(e)).filter(Boolean):a&&"object"==typeof a&&(r=Object.values(a).map(e=>e&&(e.displayName||e.name)||String(e)).filter(Boolean)),0===r.length)e="someone";else if(r.length<=2)e=r.join(", ");else{const t=r.length-2;e=`${r[0]}, ${r[1]} and ${t} other${1===t?"":"s"}`}if(Array.isArray(o))for(let e=0;e<o.length;e++)t+=Number(o[e]||0);else if(o&&"object"==typeof o)for(const e in o)Object.prototype.hasOwnProperty.call(o,e)&&(t+=Number(o[e]||0));else t=Number(o)||0;const i=await async function(e){const t=Object.values(e||{}).slice(0,3),n=[];for(const e of t){const t=await k(e.id);n.push({displayName:e.displayName||e.name||"someone",avatar:t})}return n}(a);!function(e,t={}){const n=t.duration||3e3,o=t.bgColor||"rgba(30,30,30,0.6)",a=t.textColor||"#fff",r=t.glowColor||"#fff",i=t.redirect||null,s=Array.isArray(t.users)?t.users:[],l=Number(t.maxAvatars)||5,c=Number(t.avatarSize)||28,d=Number(t.overlap)||10,p=document.createElement("div");if(Object.assign(p.style,{display:"flex",alignItems:"center",background:o,color:a,padding:"12px 16px",fontFamily:"sans-serif",fontSize:"16px",opacity:0,transform:"translateY(-50px)",transition:"transform 0.35s ease, opacity 0.35s ease, border-radius 0.25s ease, width 0.25s ease",pointerEvents:"auto",cursor:i?"pointer":"default",boxShadow:`\n      0 0 2px ${r}44,\n      0 0 6px ${r}33,\n      0 0 12px ${r}22,\n      0 0 24px ${r}11\n    `,backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:"12px",gap:"12px",whiteSpace:"nowrap",boxSizing:"border-box",overflow:"hidden"}),s.length>0){const e=document.createElement("div");Object.assign(e.style,{display:"flex",alignItems:"center",marginRight:"8px",position:"relative",height:`${c}px`,pointerEvents:"none"});const t=Math.min(s.length,l);for(let n=0;n<t;n++){const o=s[n],a=document.createElement("img");a.src=o.avatar||o.icon||"",a.alt=o.displayName||"";const r=1-n/t*.5;Object.assign(a.style,{width:`${c}px`,height:`${c}px`,borderRadius:"50%",objectFit:"cover",border:"2px solid rgba(0,0,0,0.35)",boxShadow:"0 1px 3px rgba(0,0,0,0.4)",marginLeft:0===n?"0px":`-${d}px`,opacity:r.toString(),zIndex:""+(10+t-n),display:"block"}),a.addEventListener("load",y),a.addEventListener("error",y),e.appendChild(a)}if(s.length>l){const n=document.createElement("div"),o=s.length-l;n.textContent=`+${o}`,Object.assign(n.style,{width:`${c}px`,height:`${c}px`,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",marginLeft:`-${d}px`,zIndex:`${10+t}`,background:"rgba(0,0,0,0.35)",color:"#fff",fontSize:"12px",border:"2px solid rgba(0,0,0,0.35)"}),e.appendChild(n)}p.appendChild(e)}const m=document.createElement("span");m.textContent=e,m.style.pointerEvents="auto",p.appendChild(m),i&&p.addEventListener("click",()=>{window.open(i,"_blank")}),u.appendChild(p),requestAnimationFrame(()=>{y(),requestAnimationFrame(()=>{p.style.opacity=1,p.style.transform="translateY(0)"})}),setTimeout(()=>{p.style.opacity=0,p.style.transform="translateY(-50px)",p.addEventListener("transitionend",()=>{p.remove(),y()},{once:!0})},n)}(`${t>9?"9+":String(t)} new inbounds from ${e}`,{users:i,overlap:15,bgColor:"#0606066e",glowColor:n,duration:5e3,redirect:"https://ecsr.io/My/Trades.aspx"}),C(`${t>9?"9+":String(t)} new inbounds from ${e}`,{bgColor:"#0606066e",glowColor:n,duration:5e3,redirect:"https://ecsr.io/My/Trades.aspx"})}}E=o,$=t.data}catch{}}async function N(){if(i.itemNotifications)try{const t=await fetch("https://ecsr.io/apisite/catalog/v1/search/items?category=all&limit=28&sortType=0&subcategory=all");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const o=await t.json();let a=JSON.stringify(o.data);if(console.log(a),h&&f&&(window.showNotification({title:"ECS:R",text:"ECS:R is no longer under maintenance!",duration:5500}),h=!1),null===g)console.log("Initial data loaded."),a={};else if(g!==a){console.log("Data has changed!");const t=o.data[0].id;if(GM_getValue("dropped_"+t))return;GM_setValue("dropped_"+t,"hi");const a=await fetch("https://ecsr.io/apisite/thumbnails/v1/assets?assetIds="+t);if(null==a)return console.error("Failed to get thumbnailData");const r=(await x(t)).data[0];let i=(await a.json()).data[0].imageUrl;const s=r.price,l=r.name;if(1!=r.creatorTargetId)return;let c=(r.itemRestrictions?r.itemRestrictions[0]:"").match("Limited"),d=null==s?"N/A":`${s} ROBUX`;null!=r.priceTickets&&(d=`${d} / ${r.priceTickets} TIX`);let p=`Price: ${d}`;if(c)if(null!=r.unitsAvailableForConsumption)p=`Price: ${d}\nStock: ${r.unitsAvailableForConsumption}\nLimited: true`;else{let t="";r.offsaleDeadline&&(t=`\nPeriod: ${e(r.offsaleDeadline)}`),p=`Price: ${d}\nLimited: true`+offsetDeadline}else r.offsaleDeadline&&(p=`Price: ${d}\nPeriod: ${e(r.offsaleDeadline)}`);const u={title:l,text:p,image:i,duration:0,onClickCallback:async function(){window.focus(),await GM_setValue("promptPurchase",String(t));const e=window.open("https://ecsr.io/catalog/"+t+"/--?promptPurchase=true","__eacf63");e.onload=()=>{e.promptPurchase=!0}}};C("New drop! "+l,{icon:i,bgColor:"#0606066e",glowColor:n,duration:5e3}),window.showNotification(u)}g=a}catch(e){!h&&f&&(window.showNotification({title:"ECS:R",text:"ECS:R is under maintenance!",duration:5500}),h=!0),console.error("Fetch error:",e)}}S(),setInterval(S,7500),setInterval(N,750),N(),setTimeout(async()=>{if(!window.location.href.match("https://ecsr.io/catalog/"))return;const e=Array.from(document.querySelectorAll("p")).find(e=>e.textContent.includes("Sold")),t=e?.querySelector("span.text-white"),n=window.location.href.replace("https://ecsr.io/catalog/","").split("/")[0];setInterval(async()=>{const e=await fetch(`https://ecsr.io/apisite/inventory/v2/assets/${n}/owners?cursor=0&limit=100&sortOrder=Asc`),o=await e.json();console.log(e,o),t.textContent=String((await o).data.length-1)},1e3)},5e3);let I=null;const T=new Map;let M;I=setInterval(async function e(){if(!window.location.href.match("https://ecsr.io/My/Trades.aspx"))return;const n=Array.from(document.querySelectorAll("p")).filter(e=>e.textContent.includes("Total RAP"));if(n.length<2)return;clearInterval(I);for(const e of n){const n=e.querySelector('[class*="robuxLabel"]');if(!n)continue;const o=n.parentElement.cloneNode(!0),a=n.parentElement.parentElement,r=o.querySelector('[class*="valueLabel"]'),i=o.querySelector('[class*="robuxLabel"]'),s=o.querySelector('[class*="robuxIconLg"]');if(!(r&&i&&s))continue;r.textContent="Total Value:",i.textContent="WAITING FOR ITEMS...",i.style.color="rgb(96,165,250)",s.src=GM_getResourceURL("valueIcon"),a.appendChild(o),a.style.display="flex",a.style.flexDirection="row";let l=e.closest(".row")?.nextElementSibling,c=l?l.querySelectorAll('a[href*="/catalog/"]'):[];for(;0===c.length;)l||(l=e.closest(".row")?.nextElementSibling),c=l?l.querySelectorAll('a[href*="/catalog/"]'):[],console.log(c),await t(150);i.textContent="Calculating...";const d=Array.from(c).map(e=>({name:e.textContent.trim(),href:e.href,object:e}));Array.from(c).forEach(e=>{if(!e.querySelector(".valueOverlay")){const t=document.createElement("div");t.classList.add("valueOverlay"),t.textContent="Item Value",t.style.position="absolute",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.color="white",t.style.fontWeight="bold",t.style.textAlign="center",t.style.pointerEvents="none",e.appendChild(t),e.parentElement.parentElement.addEventListener("mouseenter",()=>{t.style.opacity="1"}),e.parentElement.parentElement.addEventListener("mouseleave",()=>{t.style.opacity="0"}),t.style.opacity="0"}});let p=0;const u=d.map(async e=>{try{const t=e.href.replace("https://ecsr.io/catalog/","").split("/")[0];let n;if(T.has(t))n=T.get(t);else{const e=await fetch(`https://ecomons.xyz/api/items/${t}?owners=true`),o=await e.json();n=o.db?.value||0,0==n&&(n=o.ecsr?o.ecsr[0].rap:0),T.set(t,n)}return e.object.parentElement.getElementsByClassName("valueOverlay")[0].textContent=n,p+=n,{...e,value:n}}catch{return{...e,value:0}}});await Promise.all(u),i.textContent=p.toLocaleString()}let o=setInterval(()=>{const t=document.querySelector('[class*="valueLabel"]');t&&t.parentElement||(clearInterval(o),e(),I=setInterval(e,1e3))},100)},1e3),M=setInterval(()=>{if(!window.location.href.match("https://ecsr.io/home"))return;const e=document.querySelector('[class*="helloMessage"]');e&&(e.innerHTML=e.innerHTML.replace("Hello",function(){const e=(new Date).getHours();return e>=5&&e<12?"Morning":e>=12&&e<18?"Afternoon":"Night"}()))},50);const A={1479:GM_getResourceURL("pawIcon"),985:GM_getResourceURL("americowIcon"),111:GM_getResourceURL("chudIcon"),1841:GM_getResourceURL("chiraqIcon")},L={};for(const[e,t]of Object.entries(A))try{const n=await fetch(`https://ecsr.io/apisite/users/v1/users/${e}`),o=await n.json();o?.name&&(L[o.name.toLowerCase()]={id:Number(e),img:t})}catch(t){console.warn("Failed to fetch user",e,t)}setInterval(function(){document.querySelectorAll("span.icon-verified, span.icon-obc").forEach(e=>{const t=e.closest("p, h2, h3, div, span");if(!t)return;const n=function(e){return Array.from(e.childNodes).filter(e=>e.nodeType===Node.TEXT_NODE&&e.textContent.trim().length>0).map(e=>e.textContent.trim()).join("").toLowerCase()}(t.parentElement),o=L[n];var a,r;if(o)if(e.classList.contains("icon-verified")){e.style["background-image"]=`url('${o.img}')`;try{e.parentElement.childNodes.forEach(e=>{e&&e.className&&e.className.match("icon-obc")&&(e.style.opacity="0")})}catch(e){console.log(e)}}else"0"!=e.style.opacity&&((a=e).style.cssText=`\n            padding-left: 32px;\n            top: 2.5px;\n            position: relative;\n            background-image: url('${r}');\n            background-size: contain;\n            background-repeat: no-repeat;\n            background-position: 50%;\n            width: 20px;\n            height: 20px;\n            display: inline-block;\n        `,a.dataset.replaced="true",console.log(e.style.opacity)),e.style["background-image"]=`url('${o.img}')`})},100)}();